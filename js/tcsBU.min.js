/* tcsBU 1.0.0 (nightly) (c)  amsantos@fc.up.pt */
$(function(){"use strict";function a(a){if(P){var b=P.scale(),c=P.scaleExtent(),d=b*a,e=$("#gview").width(),f=$("#gview").height();if(c[0]<=d&&d<=c[1]){var g=P.translate(),h=[e/2,f/2];P.scale(d).translate([h[0]+(g[0]-h[0])/b*d,h[1]+(g[1]-h[1])/b*d]).event(y.transition().duration(350))}}}function b(){function a(){y.attr("transform","translate("+P.translate()+")scale("+P.scale()+")")}function b(a){z.stop(),l=a,z.start()}function c(a){z.stop(),i=a,z.start()}function e(a){z.stop().linkStrength(a).start()}function f(a){z.stop().friction(a).start()}function g(a){z.stop().gravity(a).start()}var i=K,j=L,k=M,l=J,m=I;D=[],B.sort(function(a,b){var c=a.radius<b.radius?1:a.radius>b.radius?-1:0;return c});for(var n,o=0;o<C.length;o++)n=B.filter(function(a){return a.id===C[o].source||a.id===C[o].target}),2==n.length&&D.push({source:n[0],target:n[1],id:"Link "+C[o].id,ldist:n[0].radius+n[1].radius+i+H,changes:C[o].changes});P=d3.behavior.zoom().on("zoom",a);var p=$("#gview").width(),s=$("#gview").height();y=d3.select("#gview").append("svg").attr("id","SVG").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+p+" "+s).attr("preserveAspectRatio","xMidYMid meet").call(P).append("g"),z=d3.layout.force().charge(function(a){return a?a.radius*l:l}).linkDistance(function(a){return a?a.ldist*i:i}).gravity(m).friction(k).linkStrength(j).chargeDistance(1/0).size([p,s]).on("end",function(){$("#stop").prop("disabled",!0),$("#start").prop("disabled",!1)}).on("start",function(){$("#stop").prop("disabled",!1),$("#start").prop("disabled",!0)}),t=d3.layout.pie().sort(null).value(function(a){return a.value}),u=d3.svg.arc().outerRadius(function(a){return a.data.radius}).innerRadius(0),A=y.append("defs");for(var o=1;o<w2ui.groups.records.length;o++)"none"!==w2ui.groups.records[o].pattern&&h(w2ui.groups.records[o].pattern,w2ui.groups.records[o].color);z.on("tick",function(){q.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),r.attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}),v=z.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),x=function(a){if(F){B.splice(B.indexOf(a),1);var b=D.filter(function(b){return b.source===a||b.target===a});b.map(function(a){D.splice(D.indexOf(a),1)}),d()}},w=function(a){E&&(D.splice(D.indexOf(a),1),d())},$("#charge").on("change",function(a){a.onComplete=b(a.target.value)}),$("#linkDistance").on("change",function(a){a.onComplete=c(a.target.value)}),$("#linkStrength").on("change",function(a){a.onComplete=e(a.target.value)}),$("#friction").on("change",function(a){a.onComplete=f(a.target.value)}),$("#gravity").on("change",function(a){a.onComplete=g(a.target.value)}),$("#linkDistance").attr("value",i),$("#linkStrength").attr("value",j),$("#friction").attr("value",k),$("#charge").attr("value",l),$("#gravity").attr("value",m),$("#lwidth").attr("value",O),$("#start").prop("disabled",!0).on("click",function(){$("#start").prop("disabled",!0),$("#stop").prop("disabled",!1),d()}),$("#stop").prop("disabled",!1).on("click",function(){$("#stop").prop("disabled",!0),$("#start").prop("disabled",!1),z.stop()}),$("#reset").prop("disabled",!1),w2ui.Layout_main_toolbar.enable("btn-dellink","btn-delnode","btn-svgsave","btn-outline","btn-lwidth","btn-zoomin","btn-zoomout","btn-legend"),d()}function c(a,b,c){var d="ffffff",e="none",f=w2ui.groups.find({recid:b},!0)[0];"undefined"!==f&&(d=w2ui.groups.records[f].color,"none"!==w2ui.groups.records[f].pattern&&(e="url(#"+d+w2ui.groups.records[f].pattern+")"));var g=Number(w2ui.haplotypes.records[a].haplogroup),h=$.map(B,function(a,b){return a.id===g?b:void 0})[0];if("undefined"!=typeof h){var i=$.map(B[h].proportions,function(a,c){return a.group===b?c:void 0})[0],j=$.map(B[h].proportions,function(a,b){return a.group===c?b:void 0})[0];if("undefined"!=typeof j){if("undefined"!=typeof i?(B[h].proportions[i].value++,B[h].proportions[i].color="#"+d,B[h].proportions[i].pattern=e,B[h].proportions[j].value--):(B[h].proportions.push({color:"#"+d,group:b,radius:B[h].radius,value:1,pattern:e}),B[h].proportions[j].value--),y){var k="#"+B[h].name,l=y.select(k),m=l.selectAll("path").remove();m=l.selectAll("path").data(function(a){return t(a.proportions)}),m.enter().append("path").attr("d",u).style("fill",function(a){return"none"===a.data.pattern?a.data.color:a.data.pattern}),G?m.style("stroke-width",O/2).style("stroke","#000000"):m.style("stroke-width","0").style("stroke","none"),m.exit().remove()}}else w2alert("Serious error!","ERROR")}}function d(){q=y.selectAll(".link").remove(),q=y.selectAll(".link").data(D),q.enter().append("line").attr("class","link").attr("id",function(a){return a.name}).on("mouseover",function(){d3.select(this).style({stroke:"#FF011B","stroke-width":3*O})}).on("mouseout",function(){d3.select(this).style({stroke:"#000000","stroke-width":O})}).on("click",w).append("title").text(function(a){return a.changes}),q.style("stroke-width",O).style("stroke","#000000"),q.exit().remove(),r=y.selectAll(".node").remove(),r=y.selectAll(".node").data(B),r.enter().append("g").attr("class","node").attr("id",function(a){return a.name}).on("click",x).call(v).insert("circle").attr("r",function(a){return a.radius}).on("mouseover",function(){d3.select(this).style({stroke:"#FF011B","stroke-width":4*O})}).on("mouseout",function(){d3.select(this).style({stroke:"#000000","stroke-width":2*O})}).append("title").text(function(a){return a.name}),r.style("stroke-width",function(){return 2*O}).style("stroke","#000000").style("fill","white"),r.exit().remove(),s=r.selectAll("path").remove(),s=r.selectAll("path").data(function(a){return t(a.proportions)}),s.enter().append("path").attr("d",u).style("fill",function(a){return"none"===a.data.pattern?a.data.color:a.data.pattern}),G?s.style("stroke-width",O/2).style("stroke","#000000"):s.style("stroke-width","0").style("stroke","none"),s.exit().remove(),z.nodes(B).links(D).start()}function e(a){var c=[],d=a.target,e=document.getElementById("loadGraph");if(1===d.files.length){var f=new FileReader;B=[],C=[],D=[],f.onload=function(){for(var a,d,g,h,i,j,k,l=f.result,m=l.split("\n"),n=!1,o=!1,p=!1,q=[],r=0;r<m.length;r++){if(3==m[r].indexOf("node [")&&(n=!0),3==m[r].indexOf("edge [")&&(o=!0),3==m[r].indexOf("]"))if(n){if(n=!1,q.length>0){if(d=2,""!==h){for(var s=0;s<q.length;s++)q[s]=q[s].replace(/[\W]/g,"_"),/^\d+$/.test(q[s][0])&&(q[s]="L"+q[s]),c.push({recid:q[s],haplogroup:g,group:"Default",color:"ffffff"});d=a*N}B.push({name:q[0],radius:d,proportions:[{group:"Default",value:a,radius:d,color:"#ffffff",pattern:"none"}],id:g}),q=[]}}else o?(o=!1,C.push({source:j,target:k,id:q[0],changes:i})):console.log("Serious Error!");n&&('"'==m[r][0]&&p&&(p=!1),p&&q.push(m[r].trim()),6==m[r].indexOf("id")&&(g=Number(m[r].substr(9,10).trim())),9==m[r].indexOf("Frequency")&&(a=Number(m[r].substr(30,10).trim()),a>0&&(p=!0)),6==m[r].indexOf("label")&&(h=m[r].substr(12,100).replace(/"/g," ").trim())),o&&(6==m[r].indexOf("label")&&(h=m[r].substr(12,100).replace(/"/g,"").trim()),9==m[r].indexOf("Changes")&&(i=m[r].substr(17,100).replace(/"/g,"").replace(/\t/g," ").trim()),6==m[r].indexOf("source")&&(j=Number(m[r].substr(13,100).trim())),6==m[r].indexOf("target")&&(k=Number(m[r].substr(13,100).trim())))}w2ui.haplotypes.records.length>0&&w2ui.haplotypes.clear(),w2ui.groups.records.length>1&&(w2ui.groups.clear(),w2ui.groups.add({recid:"Default",color:"ffffff",pattern:"none",editable:!1})),y&&(d3.select("#gview").selectAll("*").remove(),y=null,z=null),w2ui.haplotypes.add(c),$("#start").prop("disabled",!0),e.value="",b()},f.readAsText(d.files[0])}}function f(a){var b=a.target;if(1===b.files.length){var e=document.getElementById("loadHaplotypes"),f=new FileReader;f.onload=function(){var a,b,g,h,i,j=f.result,k=j.split("\n"),l=[];for(i=0;i<k.length;i++)a=k[i].trim(),""!==a&&(b=a.split(";"),2===b.length&&(g=b[0].trim(),""!==g&&(g=g.replace(/[\W]/g,"_"),/^\d+$/.test(g[0])&&(g="L"+g),h=b[1].trim(),""!==h&&l.push({label:g,group:h}))));if(l.length>0){var m,n,o;for(i=0;i<l.length;i++)m=w2ui.haplotypes.find({recid:l[i].label},!0)[0],n=w2ui.groups.find({recid:l[i].group},!0)[0],"undefined"!=typeof m&&"undefined"!=typeof n&&(o=w2ui.haplotypes.records[m].group,"undefined"==typeof o&&(o="Default"),w2ui.haplotypes.records[m].group=l[i].group,w2ui.haplotypes.records[m].color=w2ui.groups.records[n].color,c(m,l[i].group,o));d(),w2ui.haplotypes.refresh()}else w2alert('This seems not to be a formatted "Haplotype" file!<br>(CSV text file with haplotype and group names     <br>separated by a ; Please hit the Help button.',"No haplotypes loaded!");e.value=""},w2ui.groups.records.length>1?w2confirm("Colors will be replaced in the haplotype list! If<br>any color have already been assigned they will be<br>overriden! Load the colors' list, anyway?       <br>","Replace active group's list?").yes(function(){f.readAsText(b.files[0])}):f.readAsText(b.files[0])}}function g(a){var b=a.target;if(1===b.files.length){var d=document.getElementById("loadGroups"),e=new FileReader;e.onload=function(){var a,b,f,g,i,j,k,l,m=e.result,n=m.split("\n"),o=[{recid:"Default",color:"ffffff",pattern:"none",editable:!1}];for(a=0;a<n.length;a++)g=n[a].trim(),""!==g&&(i=g.split(";"),(2===i.length||3===i.length)&&(j=i[0].trim(),""!==j&&(k=i[1].trim(),/^#[0-9a-f]{3,6}$/i.test(k)&&(k=k.substr(1)),l="none","undefined"!=typeof i[2]&&(f=i[2].trim(),b=S.filter(function(a){return a.id===f})[0],"undefined"!=typeof b&&(l=f)),o.push({recid:j,color:k,pattern:l}))));if(o.length>1){if(w2ui.groups.clear(),w2ui.groups.add(o),w2ui.haplotypes.records.length>0){var o;for(a=0;a<w2ui.haplotypes.records.length;a++)o=w2ui.haplotypes.records[a].group,w2ui.haplotypes.records[a].group="Default",w2ui.haplotypes.records[a].color="ffffff",c(a,"Default",o);w2ui.haplotypes.refresh()}if(y)for($("pattern").remove(),a=0;a<w2ui.groups.records.length;a++)"none"!==w2ui.groups.records[a].pattern&&h(w2ui.groups.records[a].pattern,w2ui.groups.records[a].color)}else w2alert('This seems not to be a formatted "Group" file!<br>(CSV text file with group names and colors   <br>separated by a ; Please hit the Help button.',"No groups loaded!");d.value=""},w2ui.groups.records.length>1?w2confirm("Old list will be deleted! If some haplotypes have<br>already been associated with groups (colors) they<br>may revert to default group or become associated <br>with a different group                           <p>Load the new list?","Replace active group's list?").yes(function(){e.readAsText(b.files[0])}):e.readAsText(b.files[0])}}function h(a,b){if("none"!==a){var c=b+a,d=A.append("pattern");switch(d.attr("id",c).attr("patternUnits","userSpaceOnUse").attr("width",10).attr("height",10),d.append("rect").attr("width","10").attr("height","10").attr("x","0").attr("y","0").attr("fill","#"+b).attr("stroke-width","0"),a){case"lines-1":d.append("path").attr("d","M3,0 V10 M8,0 V10").attr("stroke","#000000").attr("stroke-width",.5);break;case"lines-2":d.append("path").attr("d","M3,0 V10 M8,0 V10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"lines-3":d.append("path").attr("d","M0,3 H10 M0,8 H10").attr("stroke","#000000").attr("stroke-width",.5);break;case"lines-4":d.append("path").attr("d","M0,3 H10 M0,8 H10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"lines-5":d.append("path").attr("d","M4,-1 l10,10 M-1,4 l10,10").attr("stroke","#000000").attr("stroke-width",.5);break;case"lines-6":d.append("path").attr("d","M4,-1 l10,10 M-1,4 l10,10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"lines-7":d.append("path").attr("d","M4,-1 l-10,10 M2,11 l10,-10").attr("stroke","#000000").attr("stroke-width",.5);break;case"lines-8":d.append("path").attr("d","M4,-1 l-10,10 M2,11 l10,-10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"cross-1":d.append("path").attr("d","M3,0 V10 M8,0 V10 M0,3 H10 M0,8 H10").attr("stroke","#000000").attr("stroke-width",.5);break;case"cross-2":d.append("path").attr("d","M3,0 V10 M8,0 V10 M0,3 H10 M0,8 H10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"cross-3":d.append("path").attr("d","M0,0 L10,10 M10,0 L0,10").attr("stroke","#000000").attr("stroke-width",.5);break;case"cross-4":d.append("path").attr("d","M0,0 L10,10 M10,0 L0,10").attr("stroke","#000000").attr("stroke-width",1.5);break;case"circles-1":d.append("rect").attr({width:"10",height:"10",fill:"#"+b}),d.append("circle").attr({cx:2,cy:2,r:1,transform:"translate(0,0)",fill:"#000000"}),d.append("circle").attr({cx:2,cy:7,r:1,transform:"translate(0,0)",fill:"#000000"}),d.append("circle").attr({cx:7,cy:2,r:1,transform:"translate(0,0)",fill:"#000000"}),d.append("circle").attr({cx:7,cy:7,r:1,transform:"translate(0,0)",fill:"#000000"});break;case"circles-2":d.append("rect").attr({width:"10",height:"10",fill:"#"+b}),d.append("circle").attr({cx:5,cy:5,r:3,transform:"translate(0,0)",fill:"#000000"})}}}function i(){if(R){var a,b,c=[];if(w2ui.haplotypes.records.length>0){for(var d=0;d<w2ui.haplotypes.records.length;d++)a=w2ui.haplotypes.records[d].recid,b=w2ui.haplotypes.records[d].group,c.push(a+";"+b+"\n");var e=new Blob(c,{type:"text/plain;charset=utf-8"},{endings:"native"});saveAs(e,"haplotypes.csv")}}else w2alert("FileSaver.js is not supported! Use a modern browser...<br>FileSaver.js is supported by Firefox 20+, Chrome, Chrome<br>for Android, IE 10+, Opera 15+ and Safari 6.1+","FileSave.js is unsupported!")}function j(){if(R){var a,b,c,d=[];if(w2ui.groups.records.length>0){for(var e=1;e<w2ui.groups.records.length;e++)a=w2ui.groups.records[e].recid,b=w2ui.groups.records[e].color,c=w2ui.groups.records[e].pattern,d.push(a+";#"+b+";"+c+"\n");var f=new Blob(d,{type:"text/plain;charset=utf-8"},{endings:"native"});saveAs(f,"groups.csv")}}else w2alert("FileSaver.js is not supported! Use a modern browser...<br>FileSaver.js is supported by Firefox 20+, Chrome, Chrome<br>for Android, IE 10+, Opera 15+ and Safari 6.1+","FileSave.js is unsupported!")}function k(){if(R){var a=$("#gview"),b=new Blob([a.html()],{type:"text/plain;charset=utf-8"});saveAs(b,"network.svg")}}function l(a){if(R)if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var b=window.open("examples/"+a,"_blank");b.document.close(),b.document.execCommand("SaveAs",!0,a||"examples/"+a),b.close()}}else{var c=document.createElement("a");c.href="examples/"+a,c.target="_blank",c.download=a||"unknown";var d=document.createEvent("Event");d.initEvent("click",!0,!0),c.dispatchEvent(d),(window.URL||window.webkitURL).revokeObjectURL(c.href)}else w2alert("FileSaver.js is not supported! Use a modern browser...<br>FileSaver.js is supported by Firefox 20+, Chrome, Chrome<br>for Android, IE 10+, Opera 15+ and Safari 6.1+","FileSave.js is unsupported!")}function m(){return $("body").append('<input id="loadGroups" type="file" />'),$("#loadGroups").on("change",function(a){g(a)}),$("#loadGroups").on("click",function(){this.value=null}),$().w2grid({name:"groups",multiSelect:!1,show:{header:!1,toolbar:!0,footer:!0,lineNumbers:!1,toolbarSearch:!1,toolbarReload:!1,toolbarColumns:!1,toolbarSave:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarEdit:!1},columns:[{field:"recid",caption:"Group",size:"50%",sortable:!1,resizable:!0,editable:{type:"text"},render:function(a){return'<div style="font-weight: bold">'+a.recid+"</div>"}},{field:"color",caption:"Color",size:"25%",sortable:!1,resizable:!0,editable:{type:"color"},render:function(a){return'<div style="background-color: #'+a.color+'">&nbsp;</div>'}},{field:"pattern",caption:"Pattern",size:"25%",sortable:!1,resizable:!0,editable:{type:"combo",items:S,filter:!1},render:function(a){return"<div>"+a.pattern+"</div>"}}],records:[{recid:"Default",color:"ffffff",pattern:"none",editable:!1}],toolbar:{items:[{type:"button",id:"add_group",caption:"Add",icon:"w2ui-icon-plus"},{type:"button",id:"del_group",caption:"Delete",icon:"w2ui-icon-cross"},{type:"button",id:"load_group",caption:"Load",icon:"icon-folder-open"},{type:"button",id:"save_group",caption:"Save",icon:"icon-file-save"}],onClick:function(a){switch(a.target){case"add_group":a.preventDefault();var b=w2ui.groups.find({recid:"New Group"},!0);b.length>0?w2alert('A group named "New Group" already exists! <p> Change its name first...'):(w2ui.groups.add({recid:"New Group",color:"ffffff",pattern:"none"}),this.refresh());break;case"del_group":a.force=!0;var c=w2ui.groups.getSelection()[0];if(0===c)a.preventDefault(),w2alert('Cannot delete "default" group/color...');else if(w2ui.haplotypes){var d=w2ui.haplotypes.records.filter(function(a){return a.group===c});d.length>0?(a.preventDefault(),w2alert("This group is being referenced in haplotype list!<p>Change it there, and then delete it...")):w2ui.groups["delete"](!0)}else w2ui.groups["delete"](!0);break;case"load_group":$("#loadGroups").click();break;case"save_group":j()}1===Q&&($(".legend").remove(),Q=0,p())}},onChange:function(a){var b;switch(a.preventDefault(),a.column){case 0:var d=w2ui.groups.find({recid:a.value_new},!0);if(d.length>0)w2alert('A group named "'+a.value_new+'" already exists! <p> Change its name first...');else if(w2ui.groups.records[a.index].recid=a.value_new,d=w2ui.haplotypes.find({group:a.value_original},!0),"undefined"!=typeof d&&d.length>0)for(b=0;b<d.length;b++)w2ui.haplotypes.records[d[b]].group=a.value_new,y&&c(d[b],a.value_new,a.value_original);break;case 1:if(w2ui.groups.records[a.index].color=a.value_new,"none"!==w2ui.groups.records[a.index].pattern&&($("#"+a.value_original+w2ui.groups.records[a.index].pattern).remove(),h(w2ui.groups.records[a.index].pattern,a.value_new)),d=w2ui.haplotypes.find({group:a.recid},!0),"undefined"!=typeof d&&d.length>0)for(b=0;b<d.length;b++)w2ui.haplotypes.records[d[b]].color=a.value_new,y&&c(d[b],a.recid,a.recid);break;case 2:if(w2ui.groups.records[a.index].pattern=a.value_new,y){var e=w2ui.groups.records[a.index].color;if("none"!==a.value_original&&$("#"+e+a.value_original).remove(),"none"!==a.value_new&&h(a.value_new,e),d=w2ui.haplotypes.find({group:a.recid},!0),"undefined"!=typeof d&&d.length>0)for(b=0;b<d.length;b++)c(d[b],a.recid,a.recid)}}1===Q&&($(".legend").remove(),Q=0,p()),this.refresh()}}),w2ui.groups?w2ui.groups:null}function n(){return $("body").append('<input id="loadHaplotypes" type="file" />'),$("#loadHaplotypes").on("change",function(a){f(a)}),$().w2grid({name:"haplotypes",multiSelect:!1,show:{header:!1,toolbar:!0,footer:!0,lineNumbers:!1,toolbarSearch:!1,toolbarReload:!1,toolbarColumns:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarEdit:!1},columns:[{field:"recid",caption:"Label",size:"55%",sortable:!0,resizable:!0},{field:"haplogroup",hidden:!0},{field:"color",hidden:!0},{field:"group",caption:"Group",size:"45%",sortable:!0,resizable:!0,editable:{type:"combo",items:["Default"],filter:!1},render:function(a){var b,c=parseInt(a.color,16);return b=c>8388607?"#000000":"#ffffff",'<div style="background-color: #'+a.color+"; color: "+b+'">'+a.group+"</div>"}}],toolbar:{items:[{type:"button",id:"load_haplotypes",caption:"Load",icon:"icon-folder-open"},{type:"button",id:"save_haplotypes",caption:"Save",icon:"icon-file-save"}],onClick:function(a){switch(a.target){case"load_haplotypes":0===w2ui.haplotypes.records.length?w2alert('No data loaded yet. Haplotype/Groups data can  <br>only be imported when a list of haplotypes has <br>already been loaded through "Load Data" button.<br>',"Data not yet loaded!"):$("#loadHaplotypes").click();break;case"save_haplotypes":i()}}},onChange:function(a){a.preventDefault();var b=w2ui.groups.find({recid:a.value_new},!0)[0];"undefined"!=typeof b?(w2ui.haplotypes.records[a.index].group=w2ui.groups.records[b].recid,w2ui.haplotypes.records[a.index].color=w2ui.groups.records[b].color):(w2ui.haplotypes.records[a.index].group="Default",w2ui.haplotypes.records[a.index].color="ffffff"),c(a.index,a.value_new,a.value_original)},onEditField:function(){for(var a=[],b=w2ui.groups.records,c=0;c<b.length;c++)a.push(b[c].recid);this.columns[3].editable.items=a}}),w2ui.haplotypes?w2ui.haplotypes:null}function o(b,c,e){return $("#layout").w2layout({name:"Layout",padding:0,panels:[{type:"top",size:40,resizable:!1,style:b},{type:"left",size:260,maxSize:260,resizable:!0,title:"Data",style:b,tabs:{name:"tabs",active:"tab1",tabs:[{id:"tab1",caption:"Haplotypes"},{id:"tab2",caption:"Groups"}],onClick:function(a){switch(a.target){case"tab1":w2ui.Layout.content("left",e);break;case"tab2":w2ui.Layout.content("left",c)}}}},{type:"right",size:250,resizable:!1,title:"Settings",style:b},{type:"main",size:"100%",overflow:"hidden",style:b,toolbar:{items:[{id:"btn-svgsave",type:"button",caption:"Save SVG",icon:"icon-file-svg",disabled:!0},{type:"break"},{id:"btn-zoomin","class":"zoom-btn",type:"button",caption:"Zoom In",icon:"icon-zoom-in",disabled:!0},{id:"btn-zoomout","class":"zoom-btn",type:"button",caption:"Zoom Out",icon:"icon-zoom-out",disabled:!0},{type:"break"},{id:"btn-delnode",type:"check",caption:"Delete Node",icon:"icon-delete-node",disabled:!0,checked:!1},{id:"btn-dellink",type:"check",caption:"Delete Link",icon:"icon-delete-link",disabled:!0,checked:!1},{type:"break"},{id:"btn-outline",type:"check",caption:"Outline",icon:"icon-outline",disabled:!0,checked:!1},{id:"btn-lwidth",type:"menu",caption:"Line width",icon:"icon-line-width",disabled:!0,items:[{text:"0.1 px",lwidth:"0.1"},{text:"0.2 px",lwidth:"0.2"},{text:"0.4 px",lwidth:"0.4"},{text:"0.6 px",lwidth:"0.6"},{text:"0.8 px",lwidth:"0.8"},{text:"1.0 px",lwidth:"1.0"},{text:"1.5 px",lwidth:"1.5"},{text:"2.0 px",lwidth:"2.0"}]},{id:"btn-legend",type:"check",caption:"Legend",icon:"icon-legend",disabled:!0,checked:!1}],onClick:function(b){var c=b.target;switch(c){case"btn-dellink":E=b.item.checked?!1:!0;break;case"btn-delnode":F=b.item.checked?!1:!0;break;case"btn-svgsave":k();break;case"btn-outline":G=b.item.checked?!1:!0,y&&d();break;case"btn-zoomin":a(1.2);break;case"btn-zoomout":a(.8);break;case"btn-legend":p();break;default:-1!==c.indexOf("btn-lwidth:")&&(O=b.subItem.lwidth,y&&d())}}}},{type:"bottom",size:30,resizable:!1,style:b,content:"Start"}]}),w2ui.Layout?w2ui.Layout:null}function p(){if(0===Q){Q=1;for(var a=[],b=[],c=w2ui.groups.records,d=1;d<c.length;d++)a.push(c[d].recid),b.push("none"!==c[d].pattern?"url(#"+c[d].color+c[d].pattern+")":"#"+c[d].color);var e=d3.scale.ordinal();e.domain(a),e.range(b);var f=d3.svg.legend().labelFormat("none").cellPadding(5).orientation("vertical").units("Groups").cellWidth(25).cellHeight(18).inputScale(e).cellStepping(10);d3.select("svg").append("g").attr("transform","translate(50,140)").attr("class","legend").call(f)}else Q=0,$(".legend").remove()}var q,r,s,t,u,v,w,x,y=null,z=null,A=null,B=[],C=[],D=[],E=!1,F=!1,G=!1,H=12,I=.05,J=-30,K=1,L=1,M=.95,N=5,O=1,P=null,Q=0,R=!1,S=[{id:"none"},{icon:"icon-circles-1",id:"circles-1"},{icon:"icon-circles-2",id:"circles-2"},{icon:"icon-lines-1",id:"lines-1"},{icon:"icon-lines-2",id:"lines-2"},{icon:"icon-lines-3",id:"lines-3"},{icon:"icon-lines-4",id:"lines-4"},{icon:"icon-lines-5",id:"lines-5"},{icon:"icon-lines-6",id:"lines-6"},{icon:"icon-lines-7",id:"lines-7"},{icon:"icon-lines-8",id:"lines-8"},{icon:"icon-cross-1",id:"cross-1"},{icon:"icon-cross-2",id:"cross-2"},{icon:"icon-cross-3",id:"cross-3"},{icon:"icon-cross-4",id:"cross-4"}];if(d3.svg.legend=function(){function a(h){function k(){{var a=h.append("g").attr("class","mutLegendGroup").data([f]).attr("transform","translate("+f.x+","+f.y+")"),b=a.insert("g").attr("class","mutLegendGroupText");a.insert("rect",":first-child").attr("class","mutLegendBG").attr("fill","white").attr("stroke","black").attr("stroke-width","1px")}return{parentGroup:a,target:b}}function l(){a.target.selectAll("g.legendCells").data(b).exit().remove(),a.target.selectAll("g.legendCells").select("rect").style("fill",function(a){return a.color}),"vertical"==i?(a.target.selectAll("g.legendCells").select("text.breakLabels").style("display","block").style("text-anchor","start").attr("x",c+j).attr("y",5+d/2).text(function(a){return e(a.stop[0])+(a.stop[1].length>0?" - "+e(a.stop[1]):"")}),a.target.selectAll("g.legendCells").attr("transform",function(a,b){return"translate(0,"+b*(d+j)+")"})):(a.target.selectAll("g.legendCells").attr("transform",function(a,b){return"translate("+b*c+",0)"}),a.target.selectAll("text.breakLabels").style("text-anchor","middle").attr("x",0).attr("y",-7).style("display",function(a,b){return 0===b?"none":"block"}).text(function(a){return e(a.stop[0])}))}var m=function(a){var b=10,c=a.target.node().getBBox();c.height+=2*b,c.width+=2*b,c.y-=b,c.x-=b,a.parentGroup.select(".mutLegendBG").attr(c)},n=d3.behavior.drag().on("drag",function(a){a.x+=d3.event.dx,a.y+=d3.event.dy,d3.select(this).attr("transform",function(a){return"translate("+[a.x,a.y]+")"})}).on("dragstart",function(){d3.event.sourceEvent.stopPropagation()});if(!a.initDone){var o=k();a.target=o.target,a.parentGroup=o.parentGroup,a.parentGroup.call(n),a.initDone=!0}a.target.selectAll("g.legendCells").select("text.breakLabels").remove(),a.target.selectAll("g.legendCells").select("rect").remove(),a.target.selectAll(".legendTitle").remove(),a.target.selectAll("g.legendCells").data(b).enter().append("g").attr("class","legendCells").attr("transform",function(a,b){return"translate("+b*(c+j)+",0)"}),a.target.selectAll("g.legendCells").append("rect").attr("class","breakRect").attr("height",d).attr("width",c).style("fill",function(a){return a.color}).style("stroke",function(){return"#000000"}),a.target.selectAll("g.legendCells").append("text").attr("class","breakLabels").style("pointer-events","none"),a.target.append("text").text(g).attr("y",-7).attr("class","legendTitle"),l(),m(a)}var b=[],c=80,d=30,e=d3.format(".01f"),f={x:0,y:0},g="units",h=1,i="horizontal",j=0;return a.initDone=!1,a.target,a.inputScale=function(a){var c;return arguments.length?(c=a,b=[],c.invertExtent?c.range().forEach(function(a){var d={color:a,stop:c.invertExtent(a)};b.push(d)}):c.domain().forEach(function(a){var d={color:c(a),stop:[a,""]};b.push(d)}),this):c},a.scale=function(a){var c=b[b.length-1].color;for(var d in b)if(a<b[d].stop[1]){c=b[d].color;break}return c},a.cellWidth=function(a){return arguments.length?(c=a,this):c},a.cellHeight=function(a){return arguments.length?(d=a,this):d},a.cellPadding=function(a){return arguments.length?(j=a,this):j},a.cellExtent=function(a,c){var d=b.filter(function(b){return b.color==a})[0].stop;return 1==arguments.length?d:(b.filter(function(b){return b.color==a})[0].stop=c,this)},a.cellStepping=function(a){return arguments.length?(h=a,this):h},a.units=function(a){return arguments.length?(g=a,this):g},a.orientation=function(a){return arguments.length?(i=a,this):i},a.labelFormat=function(a){return arguments.length?(e=a,"none"==a&&(e=function(a){return a}),this):e},a.place=function(a){return arguments.length?(f=a,this):a},a},window.File&&window.FileReader&&window.FileList&&window.Blob){try{{!!new Blob}R=!0}catch(T){w2alert("FileSaver.js is not supported! Use a modern browser...<br>FileSaver.js is supported by Firefox 20+, Chrome, Chrome<br>for Android, IE 10+, Opera 15+ and Safari 6.1+","File Save Failed!")}var U="background-color: #F5F6F7; border: 1px solid silver; padding: 3px",V=m(U),W=n(U),X=o(U,V,W);X.content("top",'<div style="float: left;"><button id="loadData" class="w2ui-btn">Load Data</button></div><div style="float: right;"><button id="help" class="w2ui-btn">Help</button></div>'),X.content("left",w2ui.haplotypes),X.content("right",'<div style="width=100%; height=100%;"><div style="width=100%; height=100%;"><p></p><div class="w2ui-field"><label>Link Distance:</label><div><input type="text" id="linkDistance" /></div></div><div class="w2ui-field"><label>Link Strength:</label><div><input type="text" id="linkStrength"  /></div></div><div class="w2ui-field"><label>Friction:</label><div><input type="text" id="friction"  /></div></div><div class="w2ui-field"><label>Charge:</label><div><input type="text" id="charge"  /></div></div><div class="w2ui-field"><label>Gravity:</label><div><input type="text" id="gravity" /></div></div></div><div style="width=100%; height=100%;"><p><div style="text-align: center;"><button class="w2ui-btn" id="start" name="start" disabled>Start</button></div><p><div style="text-align: center;"><button class="w2ui-btn" id="stop" name="stop" disabled>Stop</button></div></div><div style="margin: 10px; padding-top: 6px; width: 90%; height: 100%; background-color: #EFF0F1;"><p style="text-align: center;">Examples</p><div style="text-align: center;"><button class="w2ui-btn" id="tcsdata" name="tcsdata">TCS network</button></div><p><div style="text-align: center;"><button class="w2ui-btn" id="groups" name="groups">Classification Groups</button></div><p><div style="text-align: center;"><button class="w2ui-btn" id="haplotypes" name="haplotypes">Classified Haplotypes</button></div><p><div style="text-align: center;"><button class="w2ui-btn" id="gpatterns" name="gpatterns">Groups with patterns</button></div><p></div></div>'),X.content("main",'<div id="gview" style="width=100%; height=100%;"></div>'),X.content("bottom",""),$("body").append('<input id="loadGraph" type="file" />'),$("#loadGraph").on("change",function(a){e(a)}),$("#loadData").click(function(){$("#loadGraph").click()}),$("#linkDistance").w2field("float",{min:.1,max:10,step:.1,arrows:!0}),$("#linkStrength").w2field("float",{min:0,max:1,step:.02,arrows:!0}),$("#friction").w2field("float",{min:0,max:1,step:.02,arrows:!0}),$("#charge").w2field("int",{min:-1e3,max:1e3,step:10,arrows:!0}),$("#gravity").w2field("float",{min:0,max:1,step:.001,arrows:!0}),$("#tcsdata").click(function(){l("tcs-output.graph.txt")}),$("#groups").click(function(){l("groups.txt")}),$("#haplotypes").click(function(){l("haplotypes.txt")}),$("#gpatterns").click(function(){l("groups-patterns.txt")}),$("#help").click(function(){$().w2popup({url:"docs/help.html",title:"tcsBU HELP",width:800,height:500})})}else w2alert("The File APIs are not fully supported by your browser.")});